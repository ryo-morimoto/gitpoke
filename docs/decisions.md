# GitPoke 技術的意思決定

このドキュメントは、GitPokeプロジェクトにおける重要な技術的決定とその理由を記録します。

## 1. なぜRustを選択したか

### 決定
Rustでの完全新規開発

### 理由
- **パフォーマンス**: バッジ生成は高頻度アクセスが予想され、低レイテンシが重要
- **メモリ安全性**: ランタイムエラーを防ぎ、安定したサービス提供
- **エコシステム**: axum、tokioなど成熟したWebフレームワークが利用可能
- **Cloud Runとの相性**: 軽量バイナリで高速起動、コールドスタート対策

### 代替案として検討したもの
- TypeScript（Cloudflare Workers）: 当初の選択だったが、1MBサイズ制限が懸念
- Go: 良い選択肢だが、Rustのメモリ安全性とエラーハンドリングを優先

## 2. なぜGCP Cloud Runを選択したか

### 決定
GCP Cloud Runをデプロイプラットフォームとして採用

### 理由
- **柔軟性**: コンテナベースで環境を完全制御
- **自動スケーリング**: 0からのスケールが可能、コスト効率的
- **制約の緩さ**: Cloudflare Workersの1MB制限やAWS Lambdaの250MB制限と比較して余裕
- **開発体験**: Dockerでローカル環境を本番と同一に

### 代替案として検討したもの
- Cloudflare Workers: バイナリサイズ制限（1MB）が厳しい
- AWS Lambda: API Gatewayが必要で構成が複雑

## 3. なぜモノリシックアーキテクチャを選択したか

### 決定
単一コンテナのモノリシック構成

### 理由
- **シンプルさ**: 新規プロジェクトは複雑さを避けるべき
- **パフォーマンス**: サービス間通信のオーバーヘッドなし
- **開発効率**: デバッグとデプロイが簡単
- **将来性**: Cloud Runなら後からマイクロサービス化も容易

### 代替案として検討したもの
- マイクロサービス: 初期段階では過度に複雑
- サーバーレス関数の組み合わせ: 管理が煩雑

## 4. なぜこのデータストレージ構成を選択したか

### 決定
- Cloud Firestore: 永続データ
- Memorystore (Redis): ホットキャッシュ
- Cloud Storage + CDN: 静的ファイル

### 理由
- **適材適所**: 各データの特性に最適なストレージを選択
- **パフォーマンス**: 多層キャッシュで高速レスポンス
- **コスト**: アクセス頻度に応じた階層化でコスト最適化
- **可用性**: GCPマネージドサービスで高可用性を確保

## 5. なぜGitHub App認証を選択したか

### 決定
OAuth AppではなくGitHub Appを使用

### 理由
- **最小権限**: 必要な権限のみを細かく設定可能
- **セキュリティ**: User Access Tokenで個別のアクセス制御
- **将来性**: GitHub推奨の認証方式
- **Webhook対応**: アプリアンインストール時の処理が可能

### 代替案として検討したもの
- OAuth App: 権限が粗く、読み書き両方が必要
- Personal Access Token: ユーザー体験が悪い

## 6. なぜこのテスト戦略を選択したか

### 決定
- カバレッジ目標: 80%以上
- mockallとtestcontainersの併用

### 理由
- **現実的な目標**: 100%は理想だが、80%で十分な品質確保
- **統合テストの重視**: 実際の動作確認が重要
- **開発速度**: モックで高速なフィードバックループ

## 7. なぜこのCI/CD構成を選択したか

### 決定
GitHub Actions + Workload Identity

### 理由
- **統合性**: GitHubリポジトリと同じプラットフォーム
- **セキュリティ**: Workload Identityでシークレット管理不要
- **コスト**: パブリックリポジトリなら無料
- **柔軟性**: ワークフロー定義が簡単

## 今後の意思決定事項

- 監視・ログ戦略（Cloud Logging vs Datadog等）
- エラー追跡サービス（Sentry vs 自前実装）
- レート制限の実装方法